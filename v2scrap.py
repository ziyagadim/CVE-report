from selenium import webdriver
from selenium.webdriver.chrome.service import Service
from selenium.webdriver.common.by import By
from selenium.common.exceptions import NoSuchElementException 

op = webdriver.ChromeOptions()
op.add_argument('headless')
op.add_argument('--log-level=3')
driver = webdriver.Chrome(options=op)

def nist(cve_id):
    driver.get(f'https://nvd.nist.gov/vuln/detail/{cve_id}')

    # references
    references = driver.find_elements(By.XPATH, '//*[@id="vulnHyperlinksPanel"]/table/tbody')

    ref_list = []
    for elm in references:
        ref_list.append(elm.text)

    # Checks Cvss3 if not exist returns cvss2
    try:
        if bool(driver.find_element(By.ID, 'Cvss3NistCalculatorAnchor')):
            severity = driver.find_element(By.ID, 'Cvss3NistCalculatorAnchor').text
            vector = driver.find_element(By.XPATH, '//*[@id="Vuln3CvssPanel"]/div[1]/div[3]/span/span').text
    except NoSuchElementException:
        if bool(driver.find_element(By.ID, 'Cvss3NistCalculatorAnchorNA')):
            driver.find_element(By.ID, 'btn-cvss2').click()
            severity = driver.find_element(By.ID, 'Cvss2CalculatorAnchor').text
            vector = driver.find_element(By.XPATH, '//*[@id="Vuln2CvssPanel"]/div[1]/div[3]/span/span').text

    # Description handling
    try:
        description = driver.find_element(By.XPATH, '//*[@id="vulnDetailTableView"]/tbody/tr/td/div/div[1]/p').text
    except NoSuchElementException:
        print("Something went wrong with CVE ID you provided!!! Please contact with developers!")

    print(ref_list)
    print(20*"*******")
    print(severity)
    print(20*"*******")
    print(vector)
    print(20*"*******")
    print(description)



nist("CVE-2015-0144")